<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>这是添加博客页面</title>
    <script src="/static/js/jquery.js"></script>

    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/jquery.validate.js"></script>
    <script src="/static/js/jquery.form.js"></script>
</head>
<body>
<form action="http://127.0.0.1:8000/addHandle/" method="post">
    {% csrf_token %}
        <div>
            <label>标题</label>
            <input type="text" class="title" name="title">
        </div>
    <div >
        <input type="hidden" class="uid" name="uid" >
    </div>
        <div>
            <label>内容</label>
            <textarea name="content" ></textarea>
        </div>
        <div>
            <button class="btn">提交</button>
        </div>
</form>
</body>
<script>
    init();
    var currentUid;
function init() {
	currentUid=getCookie("uid")
    $(".uid").val(currentUid)
    ajax()
}
function getCookie(_key){
    var list=document.cookie;
    //先判断_key是否是cookie缓存第一个键
    _key=(list.indexOf(_key)==0)?(_key+"="):("; "+_key+"=");
    var index=list.indexOf(_key);
	//得到键的索引值
    if (index==-1) {
        return null;
    }
    var firstIndex=index+_key.length;//获得值开始的位置
        //获得值结束时的位置
    var lastIndex=list.indexOf(";",firstIndex)==-1?(list.length-1):(list.indexOf(";",firstIndex)-1);
    //值的长度为lastIndex-firstIndex+1;
    var val=list.substring(firstIndex,lastIndex+1);
    return val;
}
 function ajax() {
 	  $("form").validate({
         rules:{
                title:{
                   required:true,
                 },
                content:{
                     required:true,
                }
                },
         submitHandler:function(form){
            alert("验证成功不提交");

         $("form").ajaxSubmit(function (data) {
             //后端返回的数据
                {#console.log(data)#}
             data=JSON.parse(data)
             if(data["code"] ==0 ){
                 alert("添加成功")
                 location.href="http://127.0.0.1:8000/list/"
             }else {
                 alert("添加失败，当前标题已存在")
             }
        })
        }
     })
 }

</script>
</html>